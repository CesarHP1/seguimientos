<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seguimiento de Incidencias CCTV - Edición Profesional</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* --- PALETA DE COLORES - TEMA "SEGURIDAD" --- */
      --color-tema-principal: #943126; /* Rojo oscuro, profesional */
      --color-tema-principal-oscuro: #78281F;
      --color-tema-principal-claro: #FCF4F3;
      
      --color-exito: #27ae60;
      --color-exito-oscuro: #229954;
      --color-borrar: #5D6D7E;
      --color-borrar-oscuro: #34495E;

      --color-fondo: #f4f6f7;
      --color-fondo-gradiente: linear-gradient(135deg, #f4f6f7 0%, #e5e8eb 100%);
      --color-texto: #2c3e50;
      --color-borde: #d5dbdb;
      --color-blanco: #ffffff;
      --color-adelantado: #f39c12;
      --color-atrasado: #3498db;
      --sombra-media: 0 8px 25px rgba(44, 62, 80, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: var(--color-fondo-gradiente); color: var(--color-texto); min-height: 100vh; display: flex; flex-direction: column; }
    header { background: linear-gradient(135deg, var(--color-tema-principal-oscuro), var(--color-tema-principal)); color: var(--color-blanco); padding: 2rem 1.5rem 1rem; text-align: center; box-shadow: var(--sombra-media); position: relative; z-index: 10; border-bottom: 4px solid var(--color-tema-principal-oscuro); }
    header h1 { margin-bottom: 2rem; font-weight: 700; font-size: 2.2rem; letter-spacing: -1px; text-shadow: 0 2px 4px rgba(0,0,0,0.25); }
    #relojes-container { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 2rem; }
    .reloj-contenedor { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
    .etiqueta-zona { font-size: 0.8em; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.8; font-weight: 500; }
    .reloj-zona, #reloj-local { font-family: 'Roboto Mono', monospace; padding: 0.6rem 1rem; border-radius: 8px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.2); min-width: 170px; text-align: center; font-weight: 500; }
    #reloj-local { font-size: 1.8em; padding: 0.8rem 1.2rem; background: rgba(255,255,255,0.15); transform: scale(1.1); box-shadow: 0 0 20px rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.4); }
    main { width: 95%; max-width: 800px; margin: 3rem auto; flex: 1; }
    #camara-container { display: grid; gap: 2.5rem; }
    .camara { background: var(--color-blanco); padding: 2.5rem; border-radius: 16px; box-shadow: var(--sombra-media); position: relative; transition: transform 0.3s ease, box-shadow 0.3s ease; overflow: hidden; border: 1px solid var(--color-borde); }
    .camara:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(44, 62, 80, 0.15); }
    .panel-calculo-global { border-top: 5px solid var(--color-tema-principal); margin-bottom: 2.5rem; background: #fdfefe; }
    .camara h3 { font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--color-texto); border-bottom: 2px solid var(--color-borde); padding-bottom: 0.75rem; }
    .eliminar-camara { position: absolute; top: 1rem; right: 1rem; background: transparent; color: #aaa; border: none; width: 2.5rem; height: 2.5rem; border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
    .eliminar-camara:hover { background-color: var(--color-tema-principal-claro); color: var(--color-tema-principal); transform: scale(1.1) rotate(90deg); }
    .camara label { display: block; margin-bottom: 0.75rem; color: var(--color-texto); font-weight: 600; font-size: 1rem; }
    .camara label:not(:first-of-type){ margin-top: 1.5rem; }
    .time-inputs-container { display: flex; gap: 0.75rem; align-items: center; }
    .time-inputs-container span { font-size: 1.2rem; font-weight: 600; color: #cdd3da; }
    .time-inputs-container input[type="number"] { width: 100%; padding: 0.8rem 0.5rem; border: 2px solid var(--color-borde); border-radius: 8px; font-size: 1.2rem; font-family: 'Roboto Mono', monospace; transition: all 0.3s; background-color: #fcfdff; text-align: center; box-shadow: inset 0 2px 4px rgba(0,0,0,0.04); caret-color: var(--color-tema-principal); }
    .time-inputs-container input[type="number"]:focus { border-color: var(--color-tema-principal); outline: none; box-shadow: 0 0 0 4px rgba(148, 49, 38, 0.25), inset 0 2px 4px rgba(0,0,0,0.04); }
    input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    button { color: var(--color-blanco); border: none; padding: 0.9rem 1.8rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; display: inline-flex; align-items: center; justify-content: center; gap: 0.75rem; transition: all 0.2s ease; box-shadow: 0 4px 10px -2px rgba(0,0,0,0.2); }
    button:hover { transform: translateY(-4px); box-shadow: 0 6px 15px -3px rgba(0,0,0,0.3); }
    button:active { transform: translateY(-1px) scale(0.98); box-shadow: 0 2px 8px -1px rgba(0,0,0,0.25); }
    #btn-calcular-todo { margin-top: 1.5rem; width: 100%; background-color: var(--color-tema-principal); }
    #btn-calcular-todo:hover { background-color: var(--color-tema-principal-oscuro); }
    .botones-principales { display: flex; gap: 1rem; margin-top: 2.5rem; padding-top: 2.5rem; border-top: 1px solid var(--color-borde); }
    #agregar-camara { background-color: var(--color-exito); }
    #agregar-camara:hover { background-color: var(--color-exito-oscuro); }
    #borrar-todo { background-color: var(--color-borrar); }
    #borrar-todo:hover { background-color: var(--color-borrar-oscuro); }
    #agregar-camara::before, #borrar-todo::before { content: ''; display: inline-block; width: 1.2em; height: 1.2em; background-color: white; mask-size: cover; -webkit-mask-size: cover; }
    #agregar-camara::before { mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 5v14m-7-7h14'/%3E%3C/svg%3E"); }
    #borrar-todo::before { mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='3 6 5 6 21 6'%3E%3C/polyline%3E%3Cpath d='M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2'/%3E%3C/svg%3E"); }
    .resultado-desfase, .resultado-incidente, .error-message { margin-top: 1.5rem; padding: 1.25rem 1.5rem; border-radius: 8px; border-left: 6px solid; font-size: 1rem; line-height: 1.6; display: flex; align-items: center; gap: 1rem; }
    .resultado-desfase { background-color: #e9ecef; border-color: #bdc3c7; color: #495057; }
    .resultado-desfase.adelantado { background-color: #fef9e7; border-color: var(--color-adelantado); color: #8c5a0a; }
    .resultado-desfase.atrasado { background-color: #eaf5fb; border-color: var(--color-atrasado); color: #1a5c8e; }
    .resultado-incidente { flex-direction: column; text-align: center; gap: 0.5rem; background-color: #e9f7ef; border-color: var(--color-exito); color: #1e8449; font-weight: 500; }
    .resultado-incidente strong.hora-final { font-family: 'Roboto Mono', monospace; font-size: 2.5rem; font-weight: 700; color: var(--color-tema-principal-oscuro); letter-spacing: 1px; }
    .error-message { color: var(--color-tema-principal-oscuro); background-color: var(--color-tema-principal-claro); border-color: var(--color-tema-principal); }
    .error-message::before, .resultado-desfase::before { content: ''; flex-shrink: 0; display: inline-block; width: 1.5em; height: 1.5em; background-color: currentColor; mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center; }
    .error-message::before { mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='8' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'%3E%3C/line%3E%3C/svg%3E"); }
    .resultado-desfase.sincronizado::before { mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 11.08V12a10 10 0 1 1-5.93-9.14'/%3E%3Cpolyline points='22 4 12 14.01 9 11.01'/%3E%3C/svg%3E"); }
    .resultado-desfase.adelantado::before, .resultado-desfase.atrasado::before { mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='12' y1='16' x2='12' y2='12'%3E%3C/line%3E%3Cline x1='12' y1='8' x2='12.01' y2='8'%3E%3C/line%3E%3C/svg%3E"); }
    footer { background: var(--color-texto); color: rgba(255,255,255,0.7); padding: 2rem; text-align: center; margin-top: 3rem; font-size: 0.9rem; }
    @media (max-width: 768px) { header h1 { font-size: 1.8rem; } #relojes-container { flex-direction: column; gap: 1.5rem; } }
    @media (max-width: 600px) { main { width: 100%; padding: 0 1rem; margin: 2rem auto; } .camara { padding: 2rem 1.5rem; } .botones-principales { flex-direction: column; } button { width: 100%; } }
  </style>
</head>
<body>
  <header>
    <h1>Seguimiento de Incidencias CCTV</h1>
    <div id="relojes-container">
        <div class="reloj-contenedor">
            <div class="etiqueta-zona">Hora Pacífico (PST)</div>
            <div id="reloj-pst" class="reloj-zona">--:--:--</div>
        </div>
        <div class="reloj-contenedor">
            <div class="etiqueta-zona">Hora Local</div>
            <div id="reloj-local" class="reloj-zona">--:--:--</div>
        </div>
        <div class="reloj-contenedor">
            <div class="etiqueta-zona">Hora Este (EST)</div>
            <div id="reloj-est" class="reloj-zona">--:--:--</div>
        </div>
    </div>
  </header>

  <main>
    <div class="panel-calculo-global camara">
        <h3>Panel de Incidente</h3>
        <label for="incidente-global-h">Hora Real del Incidente (HH:MM:SS)</label>
        <div class="time-inputs-container">
            <input type="number" id="incidente-global-h" class="incidente-global-h" placeholder="HH" min="0" max="23" maxlength="2"><span>:</span>
            <input type="number" id="incidente-global-m" class="incidente-global-m" placeholder="MM" min="0" max="59" maxlength="2"><span>:</span>
            <input type="number" id="incidente-global-s" class="incidente-global-s" placeholder="SS" min="0" max="59" maxlength="2">
        </div>
        <button id="btn-calcular-todo">Calcular en Todas las Cámaras</button>
    </div>

    <div id="camara-container"></div>
    
    <div class="botones-principales">
      <button id="agregar-camara">Añadir Cámara</button>
      <button id="borrar-todo">Borrar Datos</button>
    </div>
  </main>

  <footer><p>Sistema de Cálculo de Desfase CCTV &copy; 2024</p></footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let cameraCounter = 0;
      const camaraContainer = document.getElementById('camara-container');
      const agregarCamaraBtn = document.getElementById('agregar-camara');
      const borrarTodoBtn = document.getElementById('borrar-todo');
      const btnCalcularTodo = document.getElementById('btn-calcular-todo');

      (function setupClocks() {
        const relojLocal = document.getElementById('reloj-local');
        const relojPST = document.getElementById('reloj-pst'); // Corregido de UTC a PST
        const relojEST = document.getElementById('reloj-est');
        const zonasHorarias = { 
            pst: { elemento: relojPST, opciones: { timeZone: 'America/Los_Angeles', hour12: false } }, // Corregido
            local: { elemento: relojLocal, opciones: { hour12: false } }, 
            est: { elemento: relojEST, opciones: { timeZone: 'America/New_York', hour12: false } } 
        };
        function actualizarRelojes() { const ahora = new Date(); Object.values(zonasHorarias).forEach(c => { c.elemento.textContent = ahora.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit', ...c.opciones }); }); }
        setInterval(actualizarRelojes, 1000);
        actualizarRelojes();
      })();

      function toSeconds(t) { if (!t) return 0; const [h, m, s] = t.split(':').map(Number); return h * 3600 + m * 60 + (s || 0); }
      function toHHMMSS(s) { s = (s + 86400 * 2) % 86400; const h = String(Math.floor(s/3600)).padStart(2,'0'); const m = String(Math.floor(s%3600/60)).padStart(2,'0'); const ss = String(Math.floor(s%60)).padStart(2,'0'); return `${h}:${m}:${ss}`; }
      function getTimeString(c, base) { const h = c.querySelector(`.${base}-h`).value, m = c.querySelector(`.${base}-m`).value, s = c.querySelector(`.${base}-s`).value; if (h === '' || m === '' || s === '') return null; return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`; }
      
      function setupInputNavigation(container) {
          const inputs = Array.from(container.querySelectorAll('input[type="number"]'));
          inputs.forEach((input, index) => {
              input.addEventListener('input', () => {
                  if (input.value.length >= input.maxLength && index < inputs.length - 1) {
                      inputs[index + 1].focus();
                      inputs[index + 1].select();
                  }
              });
          });
      }

      function agregarCamara() {
        cameraCounter++;
        const camaraId = `camara-${cameraCounter}`;
        const camara = document.createElement('div');
        camara.className = 'camara';
        camara.innerHTML = `
          <button class="eliminar-camara" title="Eliminar esta cámara">&times;</button>
          <h3>Cámara ${cameraCounter}</h3>
          <label for="hora-cctv-h-${camaraId}">Hora de Calibración (CCTV)</label>
          <div class="time-inputs-container">
            <input type="number" id="hora-cctv-h-${camaraId}" class="hora-cctv-h" placeholder="HH" min="0" max="23" maxlength="2"><span>:</span>
            <input type="number" id="hora-cctv-m-${camaraId}" class="hora-cctv-m" placeholder="MM" min="0" max="59" maxlength="2"><span>:</span>
            <input type="number" id="hora-cctv-s-${camaraId}" class="hora-cctv-s" placeholder="SS" min="0" max="59" maxlength="2">
          </div>
          <label for="hora-real-h-${camaraId}">Hora Real (Automática o Manual)</label>
          <div class="time-inputs-container">
            <input type="number" id="hora-real-h-${camaraId}" class="hora-real-h" placeholder="HH" min="0" max="23" maxlength="2"><span>:</span>
            <input type="number" id="hora-real-m-${camaraId}" class="hora-real-m" placeholder="MM" min="0" max="59" maxlength="2"><span>:</span>
            <input type="number" id="hora-real-s-${camaraId}" class="hora-real-s" placeholder="SS" min="0" max="59" maxlength="2">
          </div>
          <div class="resultado-desfase">A la espera de datos para calcular desfase...</div>
          <div class="resultado-incidente"></div>`;
        
        function actualizarDesfase() {
            camara.querySelector('.resultado-incidente').innerHTML = '';
            const resultadoDesfase = camara.querySelector('.resultado-desfase');
            const horaCctv = getTimeString(camara, 'hora-cctv');
            const horaReal = getTimeString(camara, 'hora-real');
            resultadoDesfase.className = 'resultado-desfase';
            if (!horaCctv || !horaReal) { resultadoDesfase.innerHTML = 'A la espera de datos...'; return; }
            const desfase = toSeconds(horaCctv) - toSeconds(horaReal);
            const sAbs = Math.abs(desfase);
            const duracion = [Math.floor(sAbs/3600),Math.floor(sAbs%3600/60),Math.floor(sAbs%60)].map((v,i)=>v>0?`<strong>${v}</strong>${'hms'[i]}`:'').filter(String).join(' ')||"<strong>0</strong>s";
            if (desfase === 0) {
                resultadoDesfase.classList.add('sincronizado');
                resultadoDesfase.innerHTML = `<strong>Sincronizado:</strong> No hay desfase.`;
            } else {
                const adelantada = desfase > 0;
                resultadoDesfase.classList.add(adelantada ? 'adelantado' : 'atrasado');
                resultadoDesfase.innerHTML = `<span>CCTV está <strong>${adelantada ? 'ADELANTADO' : 'ATRASADO'}</strong> por ${duracion}.</span>`;
            }
        };

        camara.querySelector('.hora-cctv-s').addEventListener('blur', () => {
            if (!getTimeString(camara, 'hora-real') && getTimeString(camara, 'hora-cctv')) {
                const ahora = new Date();
                camara.querySelector('.hora-real-h').value = String(ahora.getHours()).padStart(2, '0');
                camara.querySelector('.hora-real-m').value = String(ahora.getMinutes()).padStart(2, '0');
                camara.querySelector('.hora-real-s').value = String(ahora.getSeconds()).padStart(2, '0');
                actualizarDesfase();
            }
        });
        
        setupInputNavigation(camara);
        camara.querySelectorAll('input[type="number"]').forEach(input => input.addEventListener('input', actualizarDesfase));

        camara.querySelector('.eliminar-camara').addEventListener('click', () => {
          camara.style.transition = 'opacity 0.4s ease, transform 0.4s ease, max-height 0.5s ease, margin 0.5s ease, padding 0.5s ease';
          camara.style.opacity = '0'; camara.style.transform = 'scale(0.95)'; camara.style.maxHeight = '0px'; camara.style.paddingTop = '0';
          camara.style.paddingBottom = '0'; camara.style.marginTop = '0'; camara.style.marginBottom = '0';
          setTimeout(() => camara.remove(), 500);
        });
    
        camaraContainer.appendChild(camara);
        camara.querySelector('input').focus();
      }
      
      function calcularTodosLosIncidentes() {
        const panel = document.querySelector('.panel-calculo-global');
        const incidenteStr = getTimeString(panel, 'incidente-global');
        if (!incidenteStr) { alert("Ingrese la hora completa del incidente."); return; }
        const incidenteSec = toSeconds(incidenteStr);
        const camaras = document.querySelectorAll('#camara-container .camara');
        if (camaras.length === 0) { alert("Agregue al menos una cámara."); return; }
        camaras.forEach(cam => {
            const resIncidente = cam.querySelector('.resultado-incidente');
            const horaCctv = getTimeString(cam, 'hora-cctv');
            const horaReal = getTimeString(cam, 'hora-real');
            if (horaCctv && horaReal) {
                const desfase = toSeconds(horaCctv) - toSeconds(horaReal);
                resIncidente.innerHTML = `Hora a buscar: <strong class="hora-final">${toHHMMSS(incidenteSec + desfase)}</strong>`;
            } else {
                resIncidente.innerHTML = `<div class="error-message">Faltan datos de calibración.</div>`;
            }
        });
      }
    
      agregarCamaraBtn.addEventListener('click', agregarCamara);
      btnCalcularTodo.addEventListener('click', calcularTodosLosIncidentes);
      
      borrarTodoBtn.addEventListener('click', () => {
           camaraContainer.innerHTML = '';
           document.querySelectorAll('.panel-calculo-global input').forEach(input => input.value = '');
           agregarCamara();
      });
      
      setupInputNavigation(document.querySelector('.panel-calculo-global'));
      agregarCamara();
    });
</script>
</body>  
</html>